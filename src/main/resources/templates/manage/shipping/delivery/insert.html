<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns="http://www.w3.org/1999/html"
      th:replace="~{manage/layout/layout :: main-fragment(
                                                ~{:: title},
                                                ~{:: #css-resources},
                                                ~{:: #js-resources},
                                                ~{:: #main-content}
                                               )}">
<head>
  <meta charset="UTF-8">
  <title>Thêm đơn vị vận chuyển</title>

  <th:block id="css-resources">
    <style>
      .h-64 {
        height: 16rem;
      }
      .border-2 {
        border-width: 2px;
      }
      .border-gray-300 {
        --tw-border-opacity: 1;
        border-color: rgb(209 213 219/var(--tw-border-opacity));
      }
      .bg-gray-50 {
        --tw-bg-opacity: 1;
        background-color: rgb(249 250 251/var(--tw-bg-opacity));
      }
      .text-gray-500 {
        --tw-text-opacity: 1;
        color: rgb(107 114 128/var(--tw-text-opacity));
      }
      .border-dashed {
        border-style: dashed;
      }
      .rounded-lg {
        border-radius: .5rem;
      }
      .w-8 {
        width: 2rem;
      }
      .h-8 {
        height: 2rem;
      }
      .cursor-pointer {
        cursor: pointer;
      }
      .text-xs {
        font-size: .75rem;
        line-height: 1rem;
      }
      .hide {
        display: none;
      }
    </style>
  </th:block>

</head>
<body>
<th:block id="main-content">
  <main id="main" class="main">

    <div class="pagetitle">
      <h1>Thêm đơn vị vận chuyển</h1>
      <nav>
        <ol class="breadcrumb">
          <li class="breadcrumb-item"><a href="/admin/shipping">Đơn vị vận chuyển</a></li>
          <li class="breadcrumb-item active"><a href="#"></a>Thêm mới</li>
        </ol>
      </nav>
    </div><!-- End Page Title -->

    <section class="section">
      <div class="row">
        <div class="col-lg-12">

          <div class="card">
            <div class="card-body">
              <h5 class="card-title"></h5>
              <div class="row">
                <div class="col-md-6">
                  <!-- General Form Elements -->
                  <form id="form-shipping-insert">
                    <div class="row mb-3">
                      <label class="col-sm-4 col-form-label">Tên đơn vị vận chuyển</label>
                      <div class="col-sm-8">
                        <input type="text" name="name" class="form-control">
                      </div>
                    </div>

                    <div class="row mb-4">
                      <label class="col-sm-4 col-form-label">Api key</label>
                      <div class="col-sm-8">
                        <input type="text" name="apiKey" class="form-control">
                      </div>
                    </div>

                    <div class="row mb-3">
                      <label class="col-sm-4 col-form-label">API key (dev)</label>
                      <div class="col-sm-8">
                        <input type="text" name="apiKeyDev" class="form-control">
                      </div>
                    </div>

                    <div class="row mb-3 mt-5">
                      <label class="col-sm-4 col-form-label"></label>
                      <div class="row col-sm-8">
                        <div class="col-md-4 form-check">
                          <input class="form-check-input" type="radio" name="status" id="true" value="true" checked="">
                          <label class="form-check-label" for="true">
                            Sử dụng
                          </label>
                        </div>
                        <div class="col-md-4 form-check">
                          <input class="form-check-input" type="radio" name="status" id="false" value="false">
                          <label class="form-check-label" for="false">
                            Không sử dụng
                          </label>
                        </div>
                      </div>
                    </div>

                  </form>
                </div>
                <div class="col-md-6 row mb-3">
                  <div class="d-flex align-items-center justify-content-center w-100">
                    <label for="dropzone-file" class="d-flex flex-column align-items-center justify-content-center w-100 h-64 border-2 border-gray-300 border-dash rounded-lg cursor-pointer bg-gray-50 dark:hover:bg-bray-800 dark:bg-gray-700 hover:bg-gray-100 dark:border-gray-600 dark:hover:border-gray-500 dark:hover:bg-gray-600">
                      <div id="image-preview" style="position:relative; width:250px; height:250px; display: none">
                      </div>
                      <div id="no-image-preview" class="d-flex flex-column align-items-center justify-content-center pt-5 pb-5">
                          <svg class="w-8 h-8 mb-4 text-gray-500 dark:text-gray-400" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 20 16">
                            <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 13h3a3 3 0 0 0 0-6h-.025A5.56 5.56 0 0 0 16 6.5 5.5 5.5 0 0 0 5.207 5.021C5.137 5.017 5.071 5 5 5a4 4 0 0 0 0 8h2.167M10 15V6m0 0L8 8m2-2 2 2"></path>
                          </svg>
                          <p class="mb-2 text-sm text-gray-500 dark:text-gray-400"><span class="font-semibold">Click to upload</span> or drag and drop</p>
                          <p class="text-xs text-gray-500 dark:text-gray-400">SVG, PNG, JPG or GIF (MAX. 800x400px)</p>
                      </div>
                      <input id="dropzone-file" type="file" class="hide" accept="image/*" onchange="handleImagePreview('image-preview','dropzone-file',this)">
                    </label>
                  </div>
                </div>
              </div>
                <div class="row mb-3">
                  <label class="col-sm-2 col-form-label"></label>
                  <div class="col-sm-10">
                    <button type="button" class="btn btn-primary" onclick="save()">Lưu</button>
                    <button type="button" class="btn btn-danger" onclick="cancel('/admin/shipping')">Hủy</button>
                  </div>
                </div>

            </div>
          </div>

        </div>
      </div>
    </section>

  </main>
</th:block>

<th:block id="js-resources">
  <script th:inline="javascript">
    let shippingFrom = $("#form-shipping-insert");
    $(document).ready(function() {
    });

    shippingFrom.validate({
      invalidHandler: function(form, validator) {
        let errors = validator.numberOfInvalids();
        if (errors) {
          validator.errorList[0].element.focus();
        }
      },
      highlight: function(element, errorClass) {
        $(element).removeClass(errorClass);
      },
      rules: {
        name: "required"
      },
      messages: {
        name: "Vui lòng nhập tên"
      }
    });


    function handleImagePreview(idPreview, idInput, event) {
      $('#no-image-preview').remove();
      showImgPreview(idPreview, idInput, event);
    }

    function save(){
      if(shippingFrom.valid()){
        let object = {};
        let shipping = document.forms["form-shipping-insert"];
        let form = new FormData(shipping);
        form.forEach((value, key) => object[key] = value);
        let res = ajaxCall(apiDomain + '/api/v1/admin/shipping', object ,'post');
        if(res.status == "success") {
          alert("Thêm mới thành công");
          $(location).attr('href', '/admin/shipping');
        } else {
          alert(res.msg);
        }
      }
    }

  </script>
</th:block>
</body>
</html>
