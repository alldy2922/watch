<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns="http://www.w3.org/1999/html" xmlns:sec="http://www.w3.org/1999/xhtml"
      th:replace="~{manage/layout/layout :: main-fragment(
                                                ~{:: title},
                                                ~{:: #css-resources},
                                                ~{:: #js-resources},
                                                ~{:: #main-content}
                                               )}">
<head>
    <meta charset="UTF-8">
    <title>Đổi mật khẩu</title>

    <th:block id="css-resources">
        <style>

        </style>
    </th:block>

</head>
<body>
<th:block id="main-content">
    <main id="main" class="main">

        <div class="pagetitle">
            <h1>Đổi mật khẩu</h1>
        </div><!-- End Page Title -->

        <section class="section">
            <div class="row">
                <div class="col-lg-12">

                    <div class="card">
                        <div class="card-body">
                            <h5 class="card-title"></h5>

                            <!-- General Form Elements -->
                            <form id="form-user">
                                <input type="hidden" name="id" id="id-user">
                                <div class="row mb-3">
                                    <label class="col-sm-2 col-form-label">Mật khẩu cũ</label>
                                    <div class="col-sm-9">
                                        <input type="password" name="oldPassword" class="form-control">
                                    </div>
                                </div>
                                <div class="row mb-3">
                                    <label class="col-sm-2 col-form-label">Mật khẩu mới</label>
                                    <div class="col-sm-9">
                                        <input type="password" name="newPassword" class="form-control" id="new-password">
                                    </div>
                                </div>
                                <div class="row mb-3">
                                    <label class="col-sm-2 col-form-label">Nhập lại mật khẩu</label>
                                    <div class="col-sm-9">
                                        <input type="password" name="passwordConfirm" class="form-control">
                                    </div>
                                </div>

                            </form>

                            <div class="row mb-3">
                                <label class="col-sm-2 col-form-label"></label>
                                <div class="col-sm-10">
                                    <button type="button" class="btn btn-primary" onclick="saveOrUpdate()">Cập nhật</button>
                                    <button type="button" class="btn btn-danger" onclick="cancel('/')">Hủy</button>
                                </div>
                            </div>

                        </div>
                    </div>

                </div>
            </div>
        </section>

    </main>
</th:block>

<th:block id="js-resources">
    <script th:inline="javascript">

        $("#form-user").validate({
            invalidHandler: function(form, validator) {
                let errors = validator.numberOfInvalids();
                if (errors) {
                    validator.errorList[0].element.focus();
                }
            },
            highlight: function(element, errorClass) {
                $(element).removeClass(errorClass);
            },
            rules: {
                oldPassword: {
                    required: true,
                    rangelength: [4,100]
                },
                newPassword: {
                    required: true,
                    rangelength: [4,100]
                },
                passwordConfirm: {
                    equalTo: "#new-password"
                }
            },
            messages: {
                oldPassword: {
                    required: "Vui lòng nhập mật khẩu cũ",
                    rangelength: "Tên đăng nhập phải từ 4 - 100 ký tự"
                },
                newPassword: {
                    required: "Vui lòng nhập mật khẩu mới",
                    rangelength: "Tên đăng nhập phải từ 4 - 100 ký tự"
                },
                passwordConfirm: {
                    equalTo: "Mật khẩu mới không trùng khớp"
                }
            }
        });

        function saveOrUpdate(){
            if($("#form-user").valid()){
                let form = $('#form-user')[0];
                let formData = new FormData(form);
                let res = ajaxCall(apiDomain + '/api/v1/admin/user/account/password',formData,'put',false);
                if(res.status=="success") {
                    alert("Cập nhật thành công");
                }
                if(res.status == "fail"){
                    alert(res.msg);
                }
            }
        }

    </script>
</th:block>
</body>
</html>
